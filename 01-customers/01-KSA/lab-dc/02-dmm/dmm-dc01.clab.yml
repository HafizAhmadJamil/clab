name: dmm
prefix: ""
topology:
  nodes:
    # Existing ISP handoff bridge (unchanged)
    ksa-isp1:
      kind: bridge

    # Customer Edge (unchanged; still bound to your FRR config dir)
    dmm-ce-01:
      kind: linux
      image: ghcr.io/miajdev/frr
      network-mode: none
      binds:
        - config/ce-01:/etc/frr
      exec:
        - iptables -t nat -A POSTROUTING -o eth1 -j SNAT --to-source 203.0.113.2
        - ip link add lo1 type dummy
        - ip link set lo1 up
    # New DC spines
    dmm-sp1:
      kind: linux
      image: ghcr.io/miajdev/frr
      network-mode: none
      binds:
        - config/spine-01:/etc/frr
    dmm-sp2:
      kind: linux
      image: ghcr.io/miajdev/frr
      network-mode: none
      binds:
        - config/spine-02:/etc/frr

    # New DC leaves
    dmm-l1:
      kind: linux
      image: ghcr.io/miajdev/frr
      network-mode: none
      binds:
        - config/leaf-01:/etc/frr
    dmm-l2:
      kind: linux
      image: ghcr.io/miajdev/frr
      network-mode: none
      binds:
        - config/leaf-02:/etc/frr
    dmm-l3:
      kind: linux
      image: ghcr.io/miajdev/frr
      network-mode: none
      binds:
        - config/leaf-03:/etc/frr

  links:
    # ISP handoff (existing)
    - endpoints: ["dmm-ce-01:eth1", "ksa-isp1:port2"]

    # CE dual-homed into the DC fabric (border to both spines)
    - endpoints: ["dmm-ce-01:eth2", "dmm-sp1:eth1"]
    - endpoints: ["dmm-ce-01:eth3", "dmm-sp2:eth1"]

    # Leaf1 uplinks (dual to both spines)
    - endpoints: ["dmm-sp1:eth2", "dmm-l1:eth1"]
    - endpoints: ["dmm-sp2:eth2", "dmm-l1:eth2"]

    # Leaf2 uplinks
    - endpoints: ["dmm-sp1:eth3", "dmm-l2:eth1"]
    - endpoints: ["dmm-sp2:eth3", "dmm-l2:eth2"]

    # Leaf3 uplinks
    - endpoints: ["dmm-sp1:eth4", "dmm-l3:eth1"]
    - endpoints: ["dmm-sp2:eth4", "dmm-l3:eth2"]
